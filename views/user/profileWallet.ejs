
<%- include('./layouts/header') %>

<div class="page-header text-center" style="background-image: url('/userAssets/assets/images/page-header-bg.jpg')">
    <div class="container">
        <h1 class="page-title">My Account<span>Orders</span></h1>
    </div><!-- End .container -->
</div><!-- End .page-header -->
<nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
    <div class="container">
        <ol class="breadcrumb">

            <li class="breadcrumb-item active" aria-current="page">My Account</li>
            
        </ol>
    </div><!-- End .container -->
</nav><!-- End .breadcrumb-nav -->



<div class="page-content" style="padding-bottom: 0px;">
    <div class="dashboard">
        <div class="container">
            <div class="row">
                <aside class="col-md-4 col-lg-3">
                    <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link" role="tab" href="/profile">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" role="tab" href="/profileEdit"  >Edit Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/profileAddress">Address</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link "   href="/profileOrder">Order</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" id="tab-address-link" data-toggle="tab" aria-controls="tab-address" aria-selected="true"  role="tab" role="tab" href="/profileWallet">Wallet</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" role="tab" href="/logout">Sign Out</a>
                        </li>
                    </ul>
                </aside>

                <div class="col-md-8 col-lg-9">
                    <div class="tab-content">

                    



                        <div class="tab-pane fade show active" id="tab-address" role="tabpanel" aria-labelledby="tab-address-link">
                            
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card card-dashboard">
                                        <div class="card-body" style="min-height: 200px;"> <!-- Adjust the min-height as needed -->
                                            <div class="text-center mt- mb-3">
                                                <h3>Your Wallet</h3>
                                                <h5 class="mt-5"><span>Balance: </span><span>$</span><%= userWallet.amount %></h5>
                                            </div>
                                            <div class="d-flex flex-column mt-4">
                                                <button class="btn btn-link mb-2" data-toggle="modal" data-target="#addMoneyModal">Add Money</button>
                                                <button class="btn btn-link mb-2" data-toggle="modal" data-target="#history">Transaction History</button>
                                                <button class="btn btn-link" data-toggle="modal" data-target="#debitMoneyModal">Withdraw Money</button>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div><!-- End .col-lg-12 -->
                            </div>
                            
                                </div><!-- End .row -->
                            </div><!-- .End .tab-pane -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main><!-- End .main -->

<div class="modal fade" id="addMoneyModal" tabindex="-1" role="dialog" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body" style="padding: 20px;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="icon-close"></i></span>
                </button>

                <div class="tab-content" id="tab-content-5">
                    <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
                        <h5 class="modal-title text-center" id="addMoneyModalLabel">Add Money to Wallet</h5>
                        <form action="/profileWallet" method="post" id="addMoneyForm">
                            <div class="form-group">
                                <label for="singin-email">Amount</label>
                                <input type="text" class="form-control" id="money" name="money" required>
                                <span id="nameError"></span>
                            </div><!-- End .form-group -->

                            <!-- Add other form fields as needed -->

                            <div class="form-footer d-flex justify-content-center">
                                <button type="submit" class="btn btn-outline-primary-2 w-25" style="margin-right: 0px;">
                                    <span>Add Money</span>
                                  
                                </button>
                            </div><!-- End .form-footer -->
                        </form>
                    </div><!-- .End .tab-pane -->
                </div><!-- End .tab-content -->
            </div><!-- End .modal-body -->
        </div><!-- End .modal-content -->
    </div><!-- End .modal-dialog -->
</div><!-- End .modal -->





<div class="modal fade" id="debitMoneyModal" tabindex="-1" role="dialog" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body" style="padding: 20px;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="icon-close"></i></span>
                </button>

                <div class="tab-content" id="tab-content-5">
                    <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
                        <h5 class="modal-title text-center" id="addMoneyModalLabel">Withdraw Money</h5>
                        <form action="/profileWalletWithdraw" method="post" id="debitMoneyForm">
                            <div class="form-group">
                                <label for="singin-email">Amount</label>
                                <input type="text" class="form-control" id="money" name="money" required>
                                <span id="nameError"></span>
                            </div><!-- End .form-group -->

                            <!-- Add other form fields as needed -->

                            <div class="form-footer d-flex justify-content-center">
                                <button type="submit" class="btn btn-outline-primary-2 w-25" style="margin-right: 0px;">
                                    <span>Withdraw</span>
                                  
                                </button>
                            </div><!-- End .form-footer -->
                        </form>
                    </div><!-- .End .tab-pane -->
                </div><!-- End .tab-content -->
            </div><!-- End .modal-body -->
        </div><!-- End .modal-content -->
    </div><!-- End .modal-dialog -->
</div><!-- End .modal -->


<div class="modal fade" id="history" tabindex="-1" role="dialog" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body" style="padding: 20px;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="icon-close"></i></span>
                </button>

                <div class="tab-content" id="tab-content-5">
                    <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
                        <h5 class="modal-title text-center" id="addMoneyModalLabel">Transaction History</h5>
                        <div class="table-responsive">
                            <ul>
                                <% if (history && history.length > 0) { %>
                                    <table class="table table-borderless">
                                        <tbody>
                                            <% history.forEach(entry => { %>
                                                <tr>
                                                    <td class="text-center">
                                                        <% if (entry.type === 'credit') { %>
                                                            <span style="color: green;">Credit</span>
                                                        <% } else if (entry.type === 'debit') { %>
                                                            <span style="color: red;">Debit</span>
                                                        <% } else { %>
                                                            <span style="color: rgb(79, 103, 255);">Created</span>
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center">
                                                        <% if (entry.type !== 'created') { %>
                                                            <span>+</span><%= entry.amount %>
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center"><%= entry.date.toLocaleString() %></td>
                                                </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                <% } else { %>
                                    <p>No transaction history available.</p>
                                <% } %>
                            </ul>
                        </div>
                    </div><!-- .End .tab-pane -->
                </div><!-- End .tab-content -->
            </div><!-- End .modal-body -->
        </div><!-- End .modal-content -->
    </div><!-- End .modal-dialog -->
</div><!-- End .modal -->


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>







    document.getElementById('addMoneyForm').addEventListener('submit', function (e) {
        e.preventDefault();
    
       
        var moneyInput = document.getElementById('money');
        var userMoney = parseInt(moneyInput.value);

           

            var options = {
                
                key: "rzp_test_LFeXM6Qd4jOycy",
                amount: userMoney * 100,
                currency: "INR",
                name: "Assist Store",
                order_id: function() {
                            return  Math.floor(100000 + Math.random() * 900000).toString();
                        },
                handler: function (response) {
                   
                    if (response.razorpay_payment_id) {
                        // Payment successful, show success SweetAlert
                        Swal.fire({
                    icon: 'success',
                    title: '<span style="color:#c96; font-size: 24px;">Amount Added!</span>',
                    html: '<p style="color:#333; font-size: 16px;"></p>',
                    showConfirmButton: false,
                    timer: 1000,
                    background: '#fff',
                    customClass: {
                        title: 'custom-swal-title',
                        htmlContainer: 'custom-swal-html-container',
                        popup: 'custom-swal-popup'
                    }
                }).then(() => {

                            document.getElementById('addMoneyForm').submit();
                        });
                    } else {
                        // Payment failed, show error SweetAlert
                        Swal.fire({
                            icon: 'error',
                            title: 'Payment Failed',
                            text: 'Your payment was not successful. Please try again.',
                        });
                    }
                },
                
                
                theme: {
                    "color": "#2300a3"
                }
                
            };
            
            var razorpayObject = new Razorpay(options);
    
            razorpayObject.on('payment.failed', function (response) {
                console.log(response);
            });
    
            razorpayObject.open();


    });
    </script>
    
    <script>

        const message = '<%= message %>'
        const error = '<%= error %>'
        if (message) {
            Swal.fire({
                    icon: 'success',
                    title: '<span style="color:#c96; font-size: 24px;">Amount Debited!</span>',
                    html: '<p style="color:#333; font-size: 16px;"></p>',
                    showConfirmButton: false,
                    timer: 1000,
                    background: '#fff',
                    customClass: {
                        title: 'custom-swal-title',
                        htmlContainer: 'custom-swal-html-container',
                        popup: 'custom-swal-popup'
                    }
                }) 
        }else if(error){
            Swal.fire({
                    icon: 'error',
                    title: '<span style="color:#c96; font-size: 24px;">Please Try Again</span>',
                    html: '<p style="color:#333; font-size: 16px;"><%= error %></p>',
                    showConfirmButton: false,
                    timer: 2000,
                    background: '#fff',
                    customClass: {
                        title: 'custom-swal-title',
                        htmlContainer: 'custom-swal-html-container',
                        popup: 'custom-swal-popup'
                    }
                }) 
        }



    </script>

    <style>
        .custom-swal-title {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            text-align: center;
        }
    
        .custom-swal-html-container {
            text-align: center;
        }
    
        .custom-swal-popup {
            border-radius: 10px;
        }
    </style>
















<%- include('./layouts/footer') %>