<%- include('./layouts/header') %>

<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="py-3 mb-4">Products List</h4>
    <% if (typeof message !== 'undefined') { %>
    <div class="alert alert-danger alert-dismissible" role="alert">
        <%= message %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } %>
    <!-- Add  Button -->
   

    <div>


         <div class="d-flex justify-content-end mb-3">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
            Add Products
        </button>
    </div>





    
<form id="searchForm" action="/admin/product" method="get">

    <div class="py-3 d-flex flex-row">
        <div class="input-group input-group-merge">
            <span class="input-group-text" id="basic-addon-search31"><i class="bx bx-search"></i></span>
            <input
            name="search"
              type="text"
              class="form-control"
              placeholder="Search..."
              aria-label="Search..."
              aria-describedby="basic-addon-search31" />
          </div>
          <div class="ps-2">
            <button type="submit" class="btn btn-icon btn-primary"><span class="tf-icons bx bx-search-alt"></span></button>
          </div>
    </div>
    
    
    </form>
    



    </div>




    <div class="card">
        <h5 class="card-header">Products List</h5>
        <div class="table-responsive text-nowrap">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>category</th>
                        <th>Status</th>
                        <th>Edit</th>
                    </tr>
                </thead>
                <tbody class="table-border-bottom-0" id="productContainer">
                    <% product.forEach((product,index) => {%>


                    <tr>
                        <td>
                            <span class="fw-medium">
                                <%= index+1 %>
                            </span>
                        </td>
                        <td>
                            <ul class="list-unstyled users-list m-0 avatar-group d-flex align-items-center">
                                <span>
                                    <span><img src="<%= `/uploads/${product.mainImage}` %>" width="100" height="100"></span>
                                </span>
                            </ul>
                        </td>
                        <td style="max-width: 150px; word-wrap: break-word;white-space: normal;">
                            <div>
                                <%= product.name %>
                            </div>
                        </td>
                        <td>
                            <span>
                                $<%= product.mainPrice %>
                            </span>
                        </td>
                        <td>
                            <span>
                                <%= product.category.name %>
                            </span>
                        </td>
                        <td>
                            <span>
                                <div class="d-flex justify-content-center mb-2">
                                    <% if (product.isPublish===true) { %>
                                    <a href="#" onclick="blockProduct('<%- product._id %>')"
                                        class="btn btn-success">Publish</a>
                                    <%  } else { %>
                                    <a href="#" onclick="unblockProduct('<%- product._id %>')"
                                        class="btn btn-danger">Unpublish</a>
                                    <%  }  %>
                                </div>
                            </span>
                        </td>
                        <td>
                            <div class="d-inline-block justify-content-center">

                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-primary" data-bs-toggle="modal"
                                        data-bs-target="#editCategoryModal<%= product._id %>">Edit</button>
                                </div>
                            </div>
                        </td>
                    </tr>






                    <!-- Edit Product Modal -->
                    <!-- Edit Product Modal -->
                    <div class="modal fade" id="editCategoryModal<%= product._id %>" tabindex="-1"
                        aria-labelledby="editCategoryModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editCategoryModalLabel">Edit Product</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <!-- Display error message if it exists -->
                                    <% if (typeof message !== 'undefined') { %>
                                    <div class="alert alert-danger alert-dismissible" role="alert">
                                        <%= message %>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"
                                            aria-label="Close"></button>
                                    </div>
                                    <% } %>
                                    <!-- Your form content for editing a Product goes here -->

                                    <form action="/admin/product/edit/<%= product._id %>" method="post" enctype="multipart/form-data" onsubmit="return formValidationEdit('<%= product._id %>')">
                                        <div class="mb-3">
                                            <div class="form-floating">
                                                <input type="text" name="name" class="form-control" id="editName<%= product._id %>"
                                                    value="<%= product.name %>" required />
                                                <label for="name">Product Name</label>
                                               
                                                <div id="nameErrorEdit<%= product._id %>" class="form-text">
                                                    Edit the Name of the Product
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-floating">
                                                <textarea name="description" class="form-control" id="editDescription<%= product._id %>"
                                                    required><%= product.description %></textarea>
                                                <label for="description">Product Description</label>
                                                <div id="descriptionErrorEdit<%= product._id %>" class="form-text">
                                                    Edit the Description of the Product
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-floating">
                                                <input type="number" name="price" class="form-control"
                                                    value="<%= product.price %>" required  id="editPrice<%= product._id %>"/>
                                                <label for="price">Product Price</label>
                                                <div id="priceErrorEdit<%= product._id %>" class="form-text">
                                                    Edit the Price of the Product
                                                </div>
                                            </div>
                                        </div>


                                        <div class="mb-3">
                                            <div class="form-floating">
                                                <input type="number" name="discount" class="form-control" id="editDiscount<%= product._id %>"
                                                value="<%= product.discount %>"  placeholder="Product Discount" aria-describedby="floatingInputHelp" required />
                                                <label for="floatingInput">Product Discount</label>
                                                <div id="discountErrorEdit<%= product._id %>" class="form-text">
                                                    Edit the Discount of the Product
                                                </div>
                                            </div>
                                        </div>




                                                                    
                                        <div class="mb-0">
                                        <select class="form-select" name="category" required id="editCategory<%= product._id %>">
                                            <option selected value="<%= product.category._id %>" ><%= product.category.name %></option>
                                            <% category.forEach((categories) => { %>
                                                <% if(categories._id.toString() !== product.category._id.toString()) { %>
                                                    <option value="<%= categories._id %>"><%= categories.name %></option>
                                                <% } %>
                                            <% }); %> 
                                        </select>
                                        <div id="categoryErrorEdit<%= product._id %>" class="form-text">
                                            Select the Category of the Product
                                        </div>
                                        
                                        </div>








                                        <div class="mb-4">
                                            <h5 class="card-header" style="margin-left: -25px;">Stock Per Size </h5>
                                        
                                            <!-- Size XS -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeXS" class="col-md-2 col-form-label">Size XS:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>XS</label>
                                                    <input class="form-control" type="number" name="totalStockXS" id="editXS<%= product._id %>" value="<%= product.totalStock.XS %>"/>
                                                    <div id="XSerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of XS
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <!-- Size S -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeS" class="col-md-2 col-form-label">Size S:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>S</label>
                                                    <input class="form-control" type="number" name="totalStockS" id="editS<%= product._id %>" value="<%= product.totalStock.S %>"/>
                                                    <div id="SerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of S
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <!-- Size M -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeM" class="col-md-2 col-form-label">Size M:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>M</label>
                                                    <input class="form-control" type="number" name="totalStockM" id="editM<%= product._id %>" value="<%= product.totalStock.M %>"/>
                                                    <div id="MerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of M
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <!-- Size L -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeL" class="col-md-2 col-form-label">Size L:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>L</label>
                                                    <input class="form-control" type="number" name="totalStockL" id="editL<%= product._id %>" value="<%= product.totalStock.L %>"/>
                                                    <div id="LerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of L
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <!-- Size XL -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeXL" class="col-md-2 col-form-label">Size XL:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>XL</label>
                                                    <input class="form-control" type="number" name="totalStockXL" id="editXL<%= product._id %>" value="<%= product.totalStock.XL %>"/>
                                                    <div id="XlerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of XL
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <!-- Size XXL -->
                                            <div class="mb-3 row mt-3">
                                                <label for="sizeXXL" class="col-md-2 col-form-label">Size XXL:</label>
                                                <div class="col-md-10">
                                                    <label class="form-control" hidden>XXL</label>
                                                    <input class="form-control" type="number" name="totalStockXXL" id="editXXL<%= product._id %>" value="<%= product.totalStock.XXL %>"/>
                                                    <div id="XXlerrorEdit<%= product._id %>" class="form-text">
                                                        Edit the Stock of XXL
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        


                                        <!-- Main Image Section -->
                                        <div class="mb-3 d-flex justify-content-between">
                                            <div id="croppedImageContainerEdit<%= product._id %>">
                                                <span><img id="croppedImageEdit<%= product._id %>" src="/uploads/<%= product.mainImage %>" width="200" height="200" class="m-4 ms-2"></span>
                                            </div>
                                            <div>
                                            <div class="mb-3">
                                                <label for="mainImage<%= product._id %>" class="form-label">Edit Main Image</label>
                                                <div class="input-group">
                                                    <input
                                                        class="form-control"
                                                        id="mainImageEdit<%= product._id %>"
                                                        name="mainImage"
                                                        accept="image/*"
                                                        type="file"
                                                        value="<%= product.mainImage %>"
                                                    />
                                                    <!-- Add a button for clearing the main image if needed -->
                                                    <button class="btn btn-outline-danger" type="button" id="clearMainImageButton<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                                <!-- Add Crop button for mainImage -->
                                                <button class="btn btn-outline-primary" type="button" id="cropMainImageButton<%= product._id %>">Crop</button>
                                            </div>
                                        </div>

                                        <!-- Hover Image Section -->
                                        <div class="mb-3 d-flex justify-content-between">
                                            <div id="croppedImageContainerHoverEdit<%= product._id %>">
                                                <span><img id="imagePreviewHover<%= product._id %>" src="/uploads/<%= product.hoverImage %>" width="200" height="200" class="m-4 ms-2"></span>
                                            </div>
                                            <div>
                                            <div class="mb-3">
                                                <label for="hoverImage<%= product._id %>" class="form-label">Edit Hover Image</label>
                                                <div class="input-group">
                                                    <input
                                                        class="form-control"
                                                        id="hoverImageEdit<%= product._id %>"
                                                        name="hoverImage"
                                                        accept="image/*"
                                                        type="file"
                                                        value="<%= product.hoverImage %>"
                                                    />
                                                    <!-- Add a button for clearing the hover image if needed -->
                                                    <button class="btn btn-outline-danger" type="button" id="clearHoverImageButton<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                                <!-- Add Crop button for hoverImage -->
                                                <button class="btn btn-outline-primary" type="button" id="cropHoverImageButton<%= product._id %>">Crop</button>
                                            </div>
                                        </div>















                                    <!-- Edit Product 1 -->
                                    <div class="mb-3 d-flex justify-content-between">
                                        <div id="editImagePreviewContainer1<%= product._id %>">
                                            <span><img id="EditCroppedImage1<%= product._id %>" src="/uploads/<%= product.image[0] %>" width="200" height="200" class="m-4 ms-2"></span>
                                        </div>
                                        <div>
                                            <div class="mb-3">
                                                <label for="editFormFile1" class="form-label">Edit Image 1</label>
                                                <div class="input-group">
                                                    <input
                                                        type="file"
                                                        class="form-control"
                                                        id="editImage1<%= product._id %>"
                                                        aria-describedby="editInputGroupFileAddon01"
                                                        aria-label="Upload"
                                                        name="image1"
                                                        accept="image/*"
                                                        value="<%= product.image[0] %>"
                                                    />
                                                    <button class="btn btn-outline-danger" type="button" id="editClearButton1<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                            <button class="btn btn-outline-primary" type="button" id="editCropButton1<%= product._id %>">Crop</button>

                                        </div>
                                    </div>
                                    <% if (product.image[1]) { %>
                                    <!-- Repeat similar structure for Edit Product 2, Edit Product 3, and Edit Product 4 -->
                                    <div class="mb-3 d-flex justify-content-between">
                                        <div id="editImagePreviewContainer2<%= product._id %>">
                                            <span><img id="EditCroppedImage2<%= product._id %>" src="/uploads/<%= product.image[1] %>" width="200" height="200" class="m-4 ms-2"></span>
                                        </div>
                                        <div>
                                            <div class="mb-3">
                                                <label for="editFormFile2" class="form-label">Edit Image 2</label>
                                                <div class="input-group">
                                                    <input
                                                        type="file"
                                                        class="form-control"
                                                        id="editImage2<%= product._id %>"
                                                        aria-describedby="editInputGroupFileAddon02"
                                                        aria-label="Upload"
                                                        name="image2"
                                                        accept="image/*"
                                                        value="<%= product.image[1] %>"
                                                    />
                                                    <button class="btn btn-outline-danger" type="button" id="editClearButton2<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                            <button class="btn btn-outline-primary" type="button" id="editCropButton2<%= product._id %>">Crop</button>

                                        </div>
                                    </div>
                                    <% }else{ %>


                                        <div class="mb-3 d-flex justify-content-between">
                                            <div>
                                                <div class="mb-3">
                                                    <label for="editFormFile2" class="form-label">Edit Image 2</label>
                                                    <div class="input-group">
                                                        <input
                                                            type="file"
                                                            class="form-control"
                                                            id="editImage2<%= product._id %>"
                                                            aria-describedby="editInputGroupFileAddon02"
                                                            aria-label="Upload"
                                                            name="image2"
                                                            accept="image/*"
                                                            value="<%= product.image[1] %>"
                                                        />
                                                        <button class="btn btn-outline-primary" type="button" id="editCropButton2<%= product._id %>">Crop</button>
                                                        <button class="btn btn-outline-danger" type="button" id="editClearButton2<%= product._id %>">Clear</button>
                                                    </div>
                                                </div>
                                                <div id="editImagePreviewContainer2<%= product._id %>" >
                                                    <span><img style="display: none;" id="EditCroppedImage2<%= product._id %>" src="" width="200" height="200" class="m-4 ms-2"></span>
                                                </div>
                                            </div>
                                        </div>

                                    <% } %>
                                    <% if (product.image[2]) { %>
                                    <!-- Repeat similar structure for Edit Product 3 -->
                                    <div class="mb-3 d-flex justify-content-between">
                                        <div id="editImagePreviewContainer3<%= product._id %>" >
                                            <span><img id="EditCroppedImage3<%= product._id %>" src="/uploads/<%= product.image[2] %>" width="200" height="200" class="m-4 ms-2"></span>
                                        </div>
                                        <div>
                                            <div class="mb-3">
                                                <label for="editFormFile3" class="form-label">Edit Image 3</label>
                                                <div class="input-group">
                                                    <input
                                                        type="file"
                                                        class="form-control"
                                                        id="editImage3<%= product._id %>"
                                                        aria-describedby="editInputGroupFileAddon03"
                                                        aria-label="Upload"
                                                        name="image3"
                                                        accept="image/*"
                                                        value="<%= product.image[2] %>"
                                                    />
                                                   
                                                    <button class="btn btn-outline-danger" type="button" id="editClearButton3<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                            <button class="btn btn-outline-primary" type="button" id="editCropButton3<%= product._id %>">Crop</button>
                                        </div>
                                    </div>
                                    <% }else{ %>


                                        <div class="mb-3 d-flex justify-content-between">
                                          
                                            <div>
                                                <div class="mb-3">
                                                    <label for="editFormFile3" class="form-label">Edit Image 3</label>
                                                    <div class="input-group">
                                                        <input
                                                            type="file"
                                                            class="form-control"
                                                            id="editImage3<%= product._id %>"
                                                            aria-describedby="editInputGroupFileAddon03"
                                                            aria-label="Upload"
                                                            name="image3"
                                                            accept="image/*"
                                                            value="<%= product.image[2] %>"
                                                        />
                                                        <button class="btn btn-outline-primary" type="button" id="editCropButton3<%= product._id %>">Crop</button>
                                                        <button class="btn btn-outline-danger" type="button" id="editClearButton3<%= product._id %>">Clear</button>
                                                    </div>
                                                </div>
                                                <div id="editImagePreviewContainer3<%= product._id %>" >
                                                    <span><img style="display: none;" id="EditCroppedImage3<%= product._id %>" src="" width="200" height="200" class="m-4 ms-2"></span>
                                                </div>
                                            </div>
                                        </div>

                                    <% } %>
                                    <% if (product.image[3]) { %>
                                    <!-- Repeat similar structure for Edit Product 4 -->
                                    <div class="mb-3 d-flex justify-content-between">
                                        <div id="editImagePreviewContainer4<%= product._id %>">
                                            <span><img id="EditCroppedImage4<%= product._id %>" src="/uploads/<%= product.image[3] %>" width="200" height="200" class="m-4 ms-2"></span>
                                        </div>
                                        <div>
                                            <div class="mb-3">
                                                <label for="editFormFile4" class="form-label">Edit Image 4</label>
                                                <div class="input-group">
                                                    <input
                                                        type="file"
                                                        class="form-control"
                                                        id="editImage4<%= product._id %>"
                                                        aria-describedby="editInputGroupFileAddon04"
                                                        aria-label="Upload"
                                                        name="image4"
                                                        accept="image/*"
                                                        value="<%= product.image[3] %>"
                                                    />
                                                    
                                                    <button class="btn btn-outline-danger" type="button" id="editClearButton4<%= product._id %>">Clear</button>
                                                </div>
                                            </div>
                                            <button class="btn btn-outline-primary" type="button" id="editCropButton4<%= product._id %>">Crop</button>
                                        </div>
                                    </div>
                                    <% }else{ %>

                                        <div class="mb-3 d-flex justify-content-between">
                                           
                                            <div>
                                                <div class="mb-3">
                                                    <label for="editFormFile4" class="form-label">Edit Image 4</label>
                                                    <div class="input-group">
                                                        <input
                                                            type="file"
                                                            class="form-control"
                                                            id="editImage4<%= product._id %>"
                                                            aria-describedby="editInputGroupFileAddon04"
                                                            aria-label="Upload"
                                                            name="image4"
                                                            accept="image/*"
                                                            value="<%= product.image[3] %>"
                                                        />
                                                        <button class="btn btn-outline-primary" type="button" id="editCropButton4<%= product._id %>">Crop</button>

                                                        <button class="btn btn-outline-danger" type="button" id="editClearButton4<%= product._id %>">Clear</button>
                                                    </div>
                                                </div>
                                                <div  id="editImagePreviewContainer4<%= product._id %>">
                                                    <span><img style="display: none;" id="EditCroppedImage4<%= product._id %>" src="" width="200" height="200" class="m-4 ms-2"></span>
                                                </div>
                                            </div>
                                        </div>

                                    <% } %>





















                                       


                                        
                                        <div class="form-check form-switch mb-2">
                                            <input name="isComing" class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" <%= product.isComing ? 'checked' : '' %> />
                                            <label class="form-check-label" for="flexSwitchCheckChecked"
                                              >Up Coming</label>
                                             

                                            
                                          </div>



                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
























































                    
<script>
    document.addEventListener('DOMContentLoaded', () => {

        const mainImageInput = document.getElementById('mainImageEdit<%= product._id %>');
        const clearButton1 = document.getElementById('clearMainImageButton<%= product._id %>');
        const cropButton = document.getElementById('cropMainImageButton<%= product._id %>');
        const croppedImageContainer = document.getElementById('croppedImageContainerEdit<%= product._id %>');
        const croppedImage = document.getElementById('croppedImageEdit<%= product._id %>');

        let cropper;

        function initializeCropper(file) {
            
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        mainImageInput.addEventListener('change', (event) => {
       
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_Mainimage.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('mainImageEdit<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImageEdit<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton1.addEventListener('click', () => {
            console.log('trvfgdehn');
            mainImageInput.value = '';
            croppedImage.src = '';
            croppedImage.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
           
        });
    });
</script>














<script>
    document.addEventListener('DOMContentLoaded', () => {
        const hoverImageInput = document.getElementById('hoverImageEdit<%= product._id %>');
        const clearButton2 = document.getElementById('clearHoverImageButton<%= product._id %>');
        const cropButton2 = document.getElementById('cropHoverImageButton<%= product._id %>');
        const croppedImageContainer2 = document.getElementById('croppedImageContainerHoverEdit<%= product._id %>');
        const croppedImage2 = document.getElementById('imagePreviewHover<%= product._id %>');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage2, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        hoverImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage2.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer2.style.display = 'none';
            }
        });

        cropButton2.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_Hoverimage.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('hoverImageEdit<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImageContainerHoverEdit<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer2.style.display = 'none';
                });
            }
        });

        clearButton2.addEventListener('click', () => {
            hoverImageInput.value = '';
            croppedImage2.src = '';
            croppedImage2.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>




















<!-- For Image 1 --> 
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('editImage1<%= product._id %>');
        const cropButton = document.getElementById('editCropButton1<%= product._id %>');
        const clearButton = document.getElementById('editClearButton1<%= product._id %>');
        const croppedImageContainer = document.getElementById('editImagePreviewContainer1<%= product._id %>');
        const croppedImage = document.getElementById('EditCroppedImage1<%= product._id %>');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image1.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('editImage1<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('EditCroppedImage1<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                   
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            croppedImage.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
<!-- Repeat similar scripts for Image 2, Image 3, and Image 4 with corresponding IDs -->

<!-- For Image 2 --> 
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('editImage2<%= product._id %>');
        const cropButton = document.getElementById('editCropButton2<%= product._id %>');
        const clearButton = document.getElementById('editClearButton2<%= product._id %>');
        const croppedImageContainer = document.getElementById('editImagePreviewContainer2<%= product._id %>');
        const croppedImage = document.getElementById('EditCroppedImage2<%= product._id %>');
        croppedImageContainer.style.display = 'block'
        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image2.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('editImage2<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('EditCroppedImage2<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            croppedImage.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>

<!-- For Image 3 --> 
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('editImage3<%= product._id %>');
        const cropButton = document.getElementById('editCropButton3<%= product._id %>');
        const clearButton = document.getElementById('editClearButton3<%= product._id %>');
        const croppedImageContainer = document.getElementById('editImagePreviewContainer3<%= product._id %>');
        const croppedImage = document.getElementById('EditCroppedImage3<%= product._id %>');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }

            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image3.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('editImage3<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('EditCroppedImage3<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            croppedImage.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>


<!-- For Image 4 --> 
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('editImage4<%= product._id %>');
        const cropButton = document.getElementById('editCropButton4<%= product._id %>');
        const clearButton = document.getElementById('editClearButton4<%= product._id %>');
        const croppedImageContainer = document.getElementById('editImagePreviewContainer4<%= product._id %>');
        const croppedImage = document.getElementById('EditCroppedImage4<%= product._id %>');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image4.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('editImage4<%= product._id %>');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('EditCroppedImage4<%= product._id %>');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            croppedImage.style.display = 'none'
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
















































                    <% });  %>
                </tbody>
            </table>
        </div>
    </div>
</div>




<div class="d-flex justify-content-center mt-4" id="pagination">
    
    <ul class="pagination pagination-m">


        <% if (currentPage>1) { %>
            
        
        <li class="page-item prev">
          <a class="page-link" href="/admin/product?page=<%= currentPage-1 %>"
            ><i class="tf-icon bx bx-chevrons-left"></i
          ></a>
        </li>

        <% } %>
        
       <%  for(let i=1;i<=totalPage;i++){ %>
            

            
             <li class="<%= currentPage == i ? 'active':''  %>">
          <a class="page-link" href="/admin/product?page=<%= i %>"><%= i %></a>
            </li>


        <% }%>




       <% if (currentPage<totalPage) { %>
        
        <li class="page-item next">
            <a class="page-link" href="/admin/product?page=<%= parseInt(currentPage)+1 %>"
              ><i class="tf-icon bx bx-chevrons-right"></i
            ></a>
          </li>

        <% } %>
        
      </ul>

</div>
























                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Display error message if it exists -->
                <% if (typeof message !== 'undefined') { %>
                <div class="alert alert-danger alert-dismissible" role="alert">
                    <%= message %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <% } %>
                <!-- Your form content for adding a Produc goes here -->
                <form action="/admin/product/add" method="post" enctype="multipart/form-data" onsubmit="return formValidationAdd()">
                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="text" name="name" class="form-control" id="addName"
                                placeholder="Product Name" aria-describedby="floatingInputHelp" required />
                            <label for="floatingInput">Product Name</label>
                            <div id="nameError" class="form-text">
                                Enter the Name of the Product
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-floating">
                            <textarea name="description" class="form-control" placeholder="Product Description" id="addDescription" 
                                required></textarea>
                            <label for="floatingTextarea">Product Description</label>
                            <div id="descriptionError" class="form-text">
                                Enter the Description of the Product
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="number" name="price" class="form-control" id="addPrice"
                                placeholder="Product Price" aria-describedby="floatingInputHelp" required />
                            <label for="floatingInput">Product Price</label>
                            <div id="priceError" class="form-text">
                                Enter the Price of the Product
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-floating">
                            <input type="number" name="discount" class="form-control" id="addDiscount"
                                placeholder="Product Discount" aria-describedby="floatingInputHelp" required />
                            <label for="floatingInput">Product Discount</label>
                            <div id="discountError" class="form-text">
                                Enter the Discount of the Product
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <select class="form-select" name="category" aria-label="Default select example" id="addCategory" required>
                            <% category.forEach((categories) => { %>
                            <option><%= categories.name %></option>
                            <% }); %>
                        </select>
                        <div id="categoryError" class="form-text">
                            Select the Category of the Product
                        </div>
                    </div>
                    <div class="mb-4">
                        <h5 class="card-header">Stock Per Size </h5>
                    
                        <!-- Size XS -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeXS" class="col-md-2 col-form-label">Size XS:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockXS" id="addXS" required/>
                                <div id="XSerror" class="form-text">
                                    Enter the Stock of XS
                                </div>
                            </div>
                        </div>
                    
                        <!-- Size S -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeS" class="col-md-2 col-form-label">Size S:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockS" id="addS" required/>
                                <div id="Serror" class="form-text">
                                    Enter the Stock of S
                                </div>
                            </div>
                        </div>
                    
                        <!-- Size M -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeM" class="col-md-2 col-form-label">Size M:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockM" id="addM" required/>
                                <div id="Merror" class="form-text">
                                    Enter the Stock of M
                                </div>
                            </div>
                        </div>
                    
                        <!-- Size L -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeL" class="col-md-2 col-form-label">Size L:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockL" id="addL" required/>
                                <div id="Lerror" class="form-text">
                                    Enter the Stock of L
                                </div>
                            </div>
                        </div>
                    
                        <!-- Size XL -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeXL" class="col-md-2 col-form-label">Size XL:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockXL" id="addXL" required/>
                                <div id="Xlerror" class="form-text">
                                    Enter the Stock of XL
                                </div>
                            </div>
                        </div>
                    
                        <!-- Size XXL -->
                        <div class="mb-3 row mt-3">
                            <label for="sizeXXL" class="col-md-2 col-form-label">Size XXL:</label>
                            <div class="col-md-10">
                                <input class="form-control" type="number" name="totalStockXXL" id="addXXL" required/>
                                <div id="XXlerror" class="form-text">
                                    Enter the Stock of XXL
                                </div>
                            </div>
                        </div>
                    </div>
                   
                    <div class="mb-3">
                        <label for="formFile" class="form-label">Upload Main image</label>
                        <div class="input-group">
                            <input
                                type="file"
                                class="form-control"
                                id="mainImage"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="mainImage" 
                                accept=".jpg, .jpeg, .png, .webp"
                                required"/>
                            <button class="btn btn-outline-primary" type="button" id="cropButton1">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton1">Clear</button>
                        </div>
                        <div id="mainImageError" class="form-text"></div>
                    </div>
                    <div  id="croppedImageContainer">
                        <img class="d-none" src="" id="croppedImage" alt="Cropped Image">
                    </div>
                    



                    <div class="mb-3">
                        <label for="formFile" class="form-label">Upload Hover image</label>
                        <div class="input-group">
                        <input
                                type="file"
                                class="form-control"
                                id="hoverImage"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="hoverImage" 
                                accept=".jpg, .jpeg, .png, .webp"
                                required"/>
                            <button class="btn btn-outline-primary" type="button" id="cropButton2">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton2">Clear</button>
                        </div>
                        <div id="hoverImageError" class="form-text"></div>
                    </div>
                    <div id="croppedImageContainerHover">
                        <img id="imagePreviewHover" alt="Selected Image" style="max-width: 500px; display: none;" />
                    </div>
                   



  









                    <div class="mb-3">
                        <label for="formFile1" class="form-label">Upload Image 1</label>
                        <div class="input-group">
                            <input
                                type="file"
                                class="form-control"
                                id="image1"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="image1"
                                accept=".jpg, .jpeg, .png, .webp"
                                required
                            />
                            <button class="btn btn-outline-primary" type="button" id="cropButton11">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton11">Clear</button>
                        </div>
                    </div>
                    <div id="imagePreviewContainer1">
                        <img id="croppedImage1" alt="Selected Image" style="max-width: 500px; display: none;" />
                    </div>
                    
                    <!-- Repeat similar structure for Image 2, Image 3, and Image 4 -->
                    <div class="mb-3">
                        <label for="formFile2" class="form-label">Upload Image 2</label>
                        <div class="input-group">
                            <input
                                type="file"
                                class="form-control"
                                id="image2"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="image2"
                                accept=".jpg, .jpeg, .png, .webp"
                                required
                            />
                            <button class="btn btn-outline-primary" type="button" id="cropButton22">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton22">Clear</button>
                        </div>
                    </div>
                    <div id="imagePreviewContainer2">
                        <img id="croppedImage2" alt="Selected Image" style="max-width: 500px; display: none;" />
                    </div>
                    
                    <!-- Repeat similar structure for Image 3 -->
                    <div class="mb-3">
                        <label for="formFile3" class="form-label">Upload Image 3</label>
                        <div class="input-group">
                            <input
                                type="file"
                                class="form-control"
                                id="image3"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="image3"
                                accept=".jpg, .jpeg, .png, .webp"
                                required
                            />
                            <button class="btn btn-outline-primary" type="button" id="cropButton3">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton3">Clear</button>
                        </div>
                    </div>
                    <div id="imagePreviewContainer3">
                        <img id="croppedImage3" alt="Selected Image" style="max-width: 500px; display: none;" />
                    </div>
                    
                    <!-- Repeat similar structure for Image 4 -->
                    <div class="mb-3">
                        <label for="formFile4" class="form-label">Upload Image 4</label>
                        <div class="input-group">
                            <input
                                type="file"
                                class="form-control"
                                id="image4"
                                aria-describedby="inputGroupFileAddon04"
                                aria-label="Upload"
                                name="image4"
                                accept=".jpg, .jpeg, .png, .webp"
                                
                            />
                            <button class="btn btn-outline-primary" type="button" id="cropButton4">Crop</button>
                            <button class="btn btn-outline-danger" type="button" id="clearButton4">Clear</button>
                        </div>
                    </div>
                    <div id="imagePreviewContainer4">
                        <img id="croppedImage4" alt="Selected Image" style="max-width: 500px; display: none;" />
                    </div>
                    












                    
                    <div class="form-check form-switch mb-2">
                        <input name="isComing" class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" {{checked ? true:false}} />
                        <label class="form-check-label" for="flexSwitchCheckChecked"
                          >Up Coming</label>
                      </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            Close
                        </button>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>





















<!-- Add this in the head section of your HTML -->


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const mainImageInput = document.getElementById('mainImage');
        const cropButton = document.getElementById('cropButton1');
        const clearButton1 = document.getElementById('clearButton1');
        const croppedImageContainer = document.getElementById('croppedImageContainer');
        const croppedImage = document.getElementById('croppedImage');
        
        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        mainImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_Mainimage.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('mainImage');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImage');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton1.addEventListener('click', () => {
            mainImageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
           
        });
    });
</script>


















<script>
    document.addEventListener('DOMContentLoaded', () => {
        const mainImageInput = document.getElementById('hoverImage');
        const cropButton = document.getElementById('cropButton2');
        const croppedImageContainer = document.getElementById('croppedImageContainerHover')
        const croppedImage = document.getElementById('imagePreviewHover');
        
        let cropper;

        mainImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {

                    // Initialize Cropper.js
                    if (cropper) {
                        cropper.destroy();
                    }
                    cropper = new Cropper(croppedImage, {
                        aspectRatio: 1,
                        viewMode: 2,
     
                    });

                    // Set the image source
                    cropper.replace(e.target.result);
                };

                // Read the image as a data URL
                reader.readAsDataURL(file);
            }else {
                canvas.src = '';
                    if (cropper) {
                        cropper.destroy();
                    }
        }
        });

        cropButton.addEventListener('click', () => {
            // Get the cropped data URL
           
        
            const canvas = cropper.getCroppedCanvas();
                if (canvas) {
                    canvas.toBlob((blob) => {
                        const fileName = 'cropped_Hoverimage.jpg';
                        const file = new File([blob], fileName, { type: 'image/jpeg' });
                        const input = document.getElementById('hoverImage');

                        // Check if the browser supports DataTransfer and FileList
                        if (DataTransfer && FileList) {
                            const dataTransfer = new DataTransfer();
                            dataTransfer.items.add(file);
                            input.files = dataTransfer.files;
                        } else {
                            // If DataTransfer and FileList are not supported, you can't directly set input.files
                            // You may need to replace the input element with a new one or use a different approach.
                            console.error('FileList and DataTransfer are not supported in this browser.');
                        }

                        // Update the displayed image
                        const showImg = document.getElementById('imagePreviewHover');
                        showImg.src = URL.createObjectURL(blob);

                        // Hide the Cropper and save/cancel buttons
                        cropper.destroy();
                        document.getElementById(croppedImage).style.display = 'none';
                   
                    });
                }




        });

        clearButton2.addEventListener('click', () => {
            // Clear the file input and hide the Cropper preview
            mainImageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }

        });
    });     
</script>
























<!-- For Image 1 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image1');
        const cropButton = document.getElementById('cropButton11');
        const clearButton = document.getElementById('clearButton11');
        const croppedImageContainer = document.getElementById('imagePreviewContainer1');
        const croppedImage = document.getElementById('croppedImage1');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image1.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('image1');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImage1');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
<!-- Repeat similar scripts for Image 2, Image 3, and Image 4 with corresponding IDs -->




















<!-- For Image 1 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image2');
        const cropButton = document.getElementById('cropButton22');
        const clearButton = document.getElementById('clearButton22');
        const croppedImageContainer = document.getElementById('imagePreviewContainer2');
        const croppedImage = document.getElementById('croppedImage2');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image2.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('image2');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImage2');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
<!-- Repeat similar scripts for Image 2, Image 3, and Image 4 with corresponding IDs -->




















<!-- For Image 1 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image3');
        const cropButton = document.getElementById('cropButton3');
        const clearButton = document.getElementById('clearButton3');
        const croppedImageContainer = document.getElementById('imagePreviewContainer3');
        const croppedImage = document.getElementById('croppedImage3');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image3.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('image3');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImage3');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
<!-- Repeat similar scripts for Image 2, Image 3, and Image 4 with corresponding IDs -->

















<!-- For Image 1 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image4');
        const cropButton = document.getElementById('cropButton4');
        const clearButton = document.getElementById('clearButton4');
        const croppedImageContainer = document.getElementById('imagePreviewContainer4');
        const croppedImage = document.getElementById('croppedImage4');

        let cropper;

        function initializeCropper(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                });
                cropper.replace(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                initializeCropper(file);
            } else {
                croppedImage.src = '';
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                croppedImageContainer.style.display = 'none';
            }
        });

        cropButton.addEventListener('click', () => {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image4.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById('image4');

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById('croppedImage4');
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    croppedImageContainer.style.display = 'none';
                });
            }
        });

        clearButton.addEventListener('click', () => {
            imageInput.value = '';
            croppedImage.src = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });
    });
</script>
<!-- Repeat similar scripts for Image 2, Image 3, and Image 4 with corresponding IDs -->
























































































<script>

function formValidationEdit(productId) {
    const nameInput = document.getElementById(`editName${productId}`).value.trim();
    const descriptionInput = document.getElementById(`editDescription${productId}`).value.trim();
    const priceInput = document.getElementById(`editPrice${productId}`).value.trim();
    const categoryInput = document.getElementById(`editCategory${productId}`).value.trim();
    const XSinput = document.getElementById(`editXS${productId}`).value.trim();
    const Sinput = document.getElementById(`editS${productId}`).value.trim();
    const Minput = document.getElementById(`editM${productId}`).value.trim();
    const Linput = document.getElementById(`editL${productId}`).value.trim();
    const XLinput = document.getElementById(`editXL${productId}`).value.trim();
    const XXLinput = document.getElementById(`editXXL${productId}`).value.trim();

    // Get all validation messages
    const nameMessage = document.getElementById(`nameErrorEdit${productId}`);
    const descriptionMessage = document.getElementById(`descriptionErrorEdit${productId}`);
    const priceMessage = document.getElementById(`priceErrorEdit${productId}`);
    const categoryMessage = document.getElementById(`categoryErrorEdit${productId}`);
    const XSmessage = document.getElementById(`XSerrorEdit${productId}`);
    const Smessage = document.getElementById(`SerrorEdit${productId}`);
    const Mmessage = document.getElementById(`MerrorEdit${productId}`);
    const Lmessage = document.getElementById(`LerrorEdit${productId}`);
    const XLmessage = document.getElementById(`XlerrorEdit${productId}`);
    const XXLmessage = document.getElementById(`XXlerrorEdit${productId}`);

    // Clear all validation messages
    nameMessage.textContent = '';
    descriptionMessage.textContent = '';
    priceMessage.textContent = '';
    categoryMessage.textContent = '';
    XSmessage.textContent = '';
    Smessage.textContent = '';
    Mmessage.textContent = '';
    Lmessage.textContent = '';
    XLmessage.textContent = '';
    XXLmessage.textContent = '';

    // Validation regex patterns
    const nameCode = /^[A-Z][a-zA-Z0-9\s/\\-]*[^*$]+$/;
    const descriptionCode = /^[A-Za-z0-9\s\/-]+$/;
    const priceCode = /^\d+$/;
    const categoryCode = /^[a-zA-Z0-9\s\(\)\-\_]+$/;
    const sizeCode = /^\d+$/


    let isValid = true;

    // Validate Name
    if (!nameInput.match(nameCode)) {
        nameMessage.textContent = 'Invalid Name Format';
        nameMessage.style.color = 'red';
        isValid = false;
    }
  

    // Validate Description
    if (!descriptionInput.match(descriptionCode)) {
        descriptionMessage.textContent = 'Invalid Description Format';
        descriptionMessage.style.color = 'red';
        isValid = false;
    }
    


    // Validate Price
    if (!priceInput.match(priceCode)) {
        priceMessage.textContent = 'Invalid Price Format';
        priceMessage.style.color = 'red';
        isValid = false;
    }



    // Validate Category
    if (!categoryInput.match(categoryCode)) {
        categoryMessage.textContent = 'Invalid Category Format';
        categoryMessage.style.color = 'red';
        isValid = false;
    }



    // Validate Sizes
    if (!XSinput.match(sizeCode)) {
        XSmessage.textContent = 'Invalid XS Size Format';
        XSmessage.style.color = 'red';
        isValid = false;
    }

   


    if (!Sinput.match(sizeCode)) {
        Smessage.textContent = 'Invalid S Size Format';
        Smessage.style.color = 'red';
        isValid = false;
    }

   


    if (!Minput.match(sizeCode)) {
        Mmessage.textContent = 'Invalid M Size Format';
        Mmessage.style.color = 'red';
        isValid = false;
    }

  


    if (!Linput.match(sizeCode)) {
        Lmessage.textContent = 'Invalid L Size Format';
        Lmessage.style.color = 'red';
        isValid = false;
    }
    
  


    if (!XLinput.match(sizeCode)) {
        XLmessage.textContent = 'Invalid XL Size Format';
        XLmessage.style.color = 'red';
        isValid = false;
    }

   


    if (!XXLinput.match(sizeCode)) {
        XXLmessage.textContent = 'Invalid XXL Format';
        XXLmessage.style.color = 'red';
        isValid = false;
    }

    


    return isValid 
}


function formValidationAdd(){
                

                const nameInput = document.getElementById('addName').value.trim()
                const descriptionInput = document.getElementById('addDescription').value.trim()
                const priceInput = document.getElementById('addPrice').value.trim()
                const categoryInput = document.getElementById('addCategory').value.trim()
                const XSinput = document.getElementById('addXS').value.trim()
                const Sinput = document.getElementById('addS').value.trim()
                const Minput = document.getElementById('addM').value.trim()
                const Linput = document.getElementById('addL').value.trim()
                const XLinput = document.getElementById('addXL').value.trim()
                const XXLinput = document.getElementById('addXXL').value.trim()
                const mainImageInput = document.getElementById('mainImage');
                const hoverImageInput = document.getElementById('hoverImage');
             


                // Get all validation messages
    
                const nameMessage = document.getElementById('nameError')
                const descriptionMessage = document.getElementById('descriptionError')
                const priceMessage = document.getElementById('priceError')
                const categoryMessage = document.getElementById('categoryError')
                const XSmessage = document.getElementById('XSerror')
                const Smessage = document.getElementById('Serror')
                const Mmessage = document.getElementById('Merror')
                const Lmessage = document.getElementById('Lerror')
                const XLmessage = document.getElementById('Xlerror')
                const XXLmessage = document.getElementById('XXlerror')
                const mainImageMessage = document.getElementById('mainImageError');
                const hoverImageMessage = document.getElementById('hoverImageError');

                // Clear all validation messages
    
                nameMessage.textContent = ''
                descriptionMessage.textContent = ''
                priceMessage.textContent = ''
                categoryMessage.textContent = ''
                XSmessage.textContent = ''
                Smessage.textContent = ''
                Mmessage.textContent = ''
                Lmessage.textContent = ''
                XLmessage.textContent = ''
                XXLmessage.textContent = ''
                mainImageMessage.textContent = '';
                hoverImageMessage.textContent = ''; 


                nameCode = /^[A-Z][a-zA-Z0-9\s/\\-]*[^*$]+$/
                descriptionCode = /^[A-Za-z][A-Za-z0-9\s]*$/
                priceCode = /^\d+$/
                categoryCode = /^[a-zA-Z0-9\s\(\)\-\_]+$/
                XScode = /^\d+$/
                Scode =/^\d+$/
                Mcode = /^\d+$/
                Lcode= /^\d+$/
                XLcode= /^\d+$/
                XXLcode = /^\d+$/
                const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp'];

                const isValidFileType = (file, allowedTypes) => {
                    const fileType = file.type;
                    return allowedTypes.some(type => fileType.includes(type));
                };


                let isValid = true

                if (!nameInput.match(nameCode)) {
                    nameMessage.textContent = 'Invalid Name Format'
                    nameMessage.style.color = 'red'
                    isValid = false
                }
                if (!descriptionInput.match(descriptionCode)) {
                    descriptionMessage.textContent = 'Invalid description Format'
                    descriptionMessage.style.color = 'red'
                    isValid = false
                }
                if (!priceInput.match(priceCode)) {
                    priceMessage.textContent = 'Invalid Price Format'
                    priceMessage.style.color = 'red'
                    isValid = false
                }
                if (!categoryInput.match(categoryCode)) {
                    categoryMessage.textContent = 'Select a Category'
                    categoryMessage.style.color = 'red'
                    isValid = false
                }
                if (!XSinput.match(XScode)) {
                    XSmessage.textContent = 'Invalid XS Size Format'
                    XSmessage.style.color = 'red'
                    isValid = false
                }
                if (!Sinput.match(Scode)) {
                    Smessage.textContent = 'Invalid S Size Format'
                    Smessage.style.color = 'red'
                    isValid = false
                }
                if (!Minput.match(Mcode)) {
                    Mmessage.textContent = 'Invalid M Size Format'
                    Mmessage.style.color = 'red'
                    isValid = false
                }
                if (!Linput.match(Lcode)) {
                    Lmessage.textContent = 'Invalid L Size Format'
                    Lmessage.style.color = 'red'
                    isValid = false
                }
                if (!XLinput.match(XLcode)) {
                    XLmessage.textContent = 'Invalid XL Size Format'
                    XLmessage.style.color = 'red'
                    isValid = false
                }
                if (!XXLinput.match(XXLcode)) {
                    XXLmessage.textContent = 'Invalid XXL Format'
                    XXLmessage.style.color = 'red'
                    isValid = false
                }
                if (!isValidFileType(mainImageInput.files[0], allowedImageTypes)) {
                    mainImageMessage.textContent = 'Invalid main image file type. Allowed types: jpg, png, webp';
                    mainImageMessage.style.color = 'red';
                    isValid = false;
                }

                if (!isValidFileType(hoverImageInput.files[0], allowedImageTypes)) {
                    hoverImageMessage.textContent = 'Invalid hover image file type. Allowed types: jpg, png, webp';
                    hoverImageMessage.style.color = 'red';
                    isValid = false;
                }
                

                return isValid === true


    }



    function blockProduct(id) {
        window.location.href = '/admin/product/block/' + id;
        console.log('block:' + window.location.href);
    }

    function unblockProduct(id) {

        window.location.href = '/admin/product/unblock/' + id;
        console.log('unblock:' + window.location.href);
    }
</script>







    
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>


    $(document).ready(function () {
        $('#searchForm').submit(function (e) {
            e.preventDefault()
           
            $.ajax({
                type:'GET',
                url:'/admin/product',
                data:$(this).serialize(),
                success:function(response){
                        var products = response.products
                        
                    $('#productContainer').empty()
                    $('#pagination').empty()
                   
                    if (products.length > 0) {
                      
                        products.forEach((product,index) => {
                            var row =` 
                            <tr>
                        <td>
                            <span class="fw-medium">
                                ${index+1}
                            </span>
                        </td>
                        <td>
                            <ul class="list-unstyled users-list m-0 avatar-group d-flex align-items-center">
                                <span>
                                    <span><img src="/uploads/${product.mainImage}" width="100" height="100"></span>
                                </span>
                            </ul>
                        </td>
                        <td style="max-width: 150px; word-wrap: break-word;white-space: normal;">
                            <div>
                                ${product.name}
                            </div>
                        </td>
                        <td>
                            <span>
                                ${product.price}
                            </span>
                        </td>
                        <td>
                            <span>
                                ${product.category.name}
                            </span>
                        </td>
                        <td>
                            <span>
                                <div class="d-flex justify-content-center mb-2">
                                    ${
                                    product.isPublish
                                        ? `<a href="#" onclick="blockProduct('${product._id}')" class="btn btn-success">Publish</a>`
                                        : `<a href="#" onclick="unblockProduct('${product._id}')" class="btn btn-danger">Unpublish</a>`
                                    }
                                </div>
                            </span>
                        </td>
                        <td>
                            <div class="d-inline-block justify-content-center">

                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-primary" data-bs-toggle="modal"
                                        data-bs-target="#editCategoryModal${product._id}">Edit</button>
                                </div>
                            </div>
                        </td>
                    </tr>`

                        $('#productContainer').append(row);
                        });
                    } else {
                      
                        let noProductsRow = '<tr class="text-center"><td colspan="7"><h5>No products found.</h5></td></tr>';
                        $('#productContainer').append(noProductsRow);
                    }
                
                },
                error: function (error) {
                   
                    alert(error.message);
                },
            })
        })
    })




</script>




<%- include('./layouts/footer') %>